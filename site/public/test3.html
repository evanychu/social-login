<!DOCTYPE html>
<html>
<head>
    <title>social-login; test3; firebaseui; callback</title>

    <!-- Begin Firebase basic. -->
    <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyDeNz9JaYBc9A0JMXPc07FBWxkkHITki98",
            authDomain: "coleman-e5ccf.firebaseapp.com",
            databaseURL: "https://coleman-e5ccf.firebaseio.com",
            projectId: "coleman-e5ccf",
            storageBucket: "coleman-e5ccf.appspot.com",
            messagingSenderId: "1025692702293"
        };
        firebase.initializeApp(config);
    </script>
    <!-- End Firebase basic. -->

    <!-- Begin FirebaseUI. -->
    <script src="https://cdn.firebase.com/libs/firebaseui/3.1.0/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.1.0/firebaseui.css" />
    <!-- End FirebaseUI. -->

    <script type="text/javascript">
        var uiConfig = {
            signInOptions: [
                firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                firebase.auth.FacebookAuthProvider.PROVIDER_ID,
            ],
            // Terms of service url.
            tosUrl: 'https://coleman-e5ccf.firebaseapp.com/tos.html',
            callbacks: {
                signInSuccessWithAuthResult: function (authResult, redirectUrl) {
                    console.log("signInSuccessWithAuthResult: enter");
                    var user = authResult.user;
                    var credential = authResult.credential;
                    var isNewUser = authResult.additionalUserInfo.isNewUser;
                    var providerId = authResult.additionalUserInfo.providerId;
                    var operationType = authResult.operationType;
                    myPostMessage("call from test3.html");
                    // Do something with the returned AuthResult.
                    // Return type determines whether we continue the redirect automatically
                    // or whether we leave that to developer to handle.
                    console.log("signInSuccessWithAuthResult: exit");
                    return false; // Do not redirect.
                },
            }
        };
        // Initialize the FirebaseUI Widget using Firebase.
        var ui = new firebaseui.auth.AuthUI(firebase.auth());
        // The start method will wait until the DOM is loaded.
        ui.start('#firebaseui-auth-container', uiConfig);
    </script>

    <script type="text/javascript">
        initApp = function () {
            firebase.auth().onAuthStateChanged(function (user) {
                console.log("onAuthStateChanged: ok; enter");
                if (user) {
                    console.log("onAuthStateChanged: ok; signed in");
                    myPostMessage("call from onAuthStateChanged signed in");
                    // User is signed in.
                    var displayName = user.displayName;
                    var email = user.email;
                    var emailVerified = user.emailVerified;
                    var photoURL = user.photoURL;
                    var uid = user.uid;
                    var phoneNumber = user.phoneNumber;
                    var providerData = user.providerData;
                    user.getIdToken().then(function (accessToken) {
                        // document.getElementById('sign-in-status').textContent = 'Signed in';
                        // document.getElementById('sign-in').textContent = 'Sign out';
                        // document.getElementById('account-details').textContent = JSON.stringify({
                        //     displayName: displayName,
                        //     email: email,
                        //     emailVerified: emailVerified,
                        //     phoneNumber: phoneNumber,
                        //     photoURL: photoURL,
                        //     uid: uid,
                        //     accessToken: accessToken,
                        //     providerData: providerData
                        //}, null, '  ');
                    });
                } else {
                    // User is signed out.
                    console.log("onAuthStateChanged: ok; signed out");
                    myPostMessage("call from onAuthStateChanged signed out");
                    //document.getElementById('sign-in-status').textContent = 'Signed out';
                    //document.getElementById('sign-in').textContent = 'Sign in';
                    //document.getElementById('account-details').textContent = 'null';
                }
                console.log("onAuthStateChanged: ok; enter");
            }, function (error) {
                console.log("onAuthStateChanged: error; enter");
                console.log(error);
                myPostMessage("call from onAuthStateChanged error");
                console.log("onAuthStateChanged: error; exit");
            });
        };

        window.addEventListener('load', function () {
            initApp()
        });
    </script>
</head>

<body>

    <div id="message">
        <h1>social-login; test3; firebaseui; callback</h1>
        <button id="idButton1" type="button" onclick="clickHandler()">button 1</button>
        <div id="firebaseui-auth-container"></div>
    </div>

    <script>
        function clickHandler() {
            console.log("clickHandler: enter");
            myPostMessage("call from clickHandler");
            console.log("clickHandler: exit");
        }

        function myPostMessage(text) {
            document.getElementById("idButton1").style.color = "red";
            try {
                window.postMessage(test);
            }
            catch (ex) {
                console.error("myPostMessage: postMessage error");
            }
        }
    </script>

</body>
</html>